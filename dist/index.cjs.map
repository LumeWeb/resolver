{"version":3,"sources":["../src/index.ts","../src/DnsQuery.ts","../src/DnsNetwork.ts","../src/Resolver.ts","../src/lib/util.ts","../src/SubResolverBase.ts","../src/resolvers/handshake.ts","../src/resolvers/icann.ts","../src/resolvers/eip137.ts","../src/resolvers/eip137/GunProvider.ts","../src/data/pocketNetworks.ts","../src/resolvers/solana.ts","../src/resolvers/solana/connection.ts"],"sourcesContent":["import Resolver from \"./Resolver.js\";\nexport * from \"./Resolver.js\";\nimport Handshake from \"./resolvers/handshake.js\";\nimport Icann from \"./resolvers/icann.js\";\nimport Eip137 from \"./resolvers/eip137.js\";\nimport Solana from \"./resolvers/solana.js\";\n\nconst resolvers = {\n  Icann,\n  Handshake,\n  Eip137,\n  createDefaultResolver: () => {\n    const defaultResolver = new Resolver();\n    defaultResolver.registerResolver(new Icann(defaultResolver));\n    defaultResolver.registerResolver(new Eip137(defaultResolver));\n    defaultResolver.registerResolver(new Solana(defaultResolver));\n    defaultResolver.registerResolver(new Handshake(defaultResolver));\n\n    return defaultResolver;\n  },\n};\n\nexport * from \"./lib/util.js\";\nexport default resolvers;\nexport { Resolver };\n","import DnsNetwork from \"./DnsNetwork.js\";\nimport crypto from \"crypto\";\nimport { Portal } from \"./Resolver\";\nimport { clearTimeout, setTimeout, setInterval } from \"timers\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { IGunSubscription, subscribe } from \"gun-util\";\n\nexport type DnsResponse = {\n  updated: number;\n  requests: number;\n  data: object | string | boolean | null;\n};\n\nexport type DnsRequest = {\n  query: string;\n  chain: string;\n  data: object | any[] | string;\n  force?: boolean;\n};\n\nexport default class DnsQuery {\n  private _network: DnsNetwork;\n  private _query: DnsRequest;\n  private _requestId?: string;\n  private _responses: { [peer: string]: DnsResponse | null } = {};\n  private _handlers: { [peer: string]: IGunSubscription } = {};\n  private _cachedHandler: { [peer: string]: boolean } = {};\n  private _timeoutTimer?: any;\n  private _timeout: boolean = false;\n  private _promise?: Promise<any>;\n  private _promiseResolve?: (data: any) => void;\n  private _cachedResponses: { [peer: string]: DnsResponse | null } = {};\n  private _cacheChecked = false;\n  private _cachedTimers: { [peer: string]: NodeJS.Timer } = {};\n  private _requestSent: boolean = false;\n  private _completed: boolean = false;\n\n  constructor(network: DnsNetwork, query: DnsRequest) {\n    this._network = network;\n    this._query = query;\n    this.init();\n  }\n\n  get promise(): Promise<any> {\n    return this._promise as Promise<any>;\n  }\n\n  private async init() {\n    const hash = crypto\n      .createHash(\"sha256\")\n      .update(JSON.stringify(this._query.data))\n      .digest(\"hex\");\n\n    if (this._query.force) {\n      this._query.force = true;\n    }\n\n    this._requestId =\n      this._requestId ?? `${this._query.query};${this._query.chain};${hash}`;\n    this._promise =\n      this._promise ??\n      new Promise<any>((resolve) => {\n        this._promiseResolve = resolve;\n      });\n\n    if (this._query.force) {\n      this._cacheChecked = true;\n    }\n\n    this.addPeer = this.addPeer.bind(this);\n    this._network.on(\"newActivePeer\", this.addPeer);\n\n    await this._network.waitForPeers();\n\n    await Promise.allSettled(\n      Object.keys(this._network.activePeers).map((peer) => this.addPeer(peer))\n    );\n    this._timeoutTimer =\n      this._timeoutTimer ??\n      setTimeout(\n        this.handeTimeout.bind(this),\n        this._network.queryTimeout * 1000\n      );\n  }\n\n  private getCachedRecordHandler(\n    pubkey: string\n  ): (response: DnsResponse) => void {\n    return (response?: DnsResponse) => {\n      if (pubkey in this._cachedResponses) {\n        return;\n      }\n      if (response) {\n        if (!this.hasResponseExpired(response)) {\n          this._cachedResponses[pubkey] = this.isInvalidResponse(response)\n            ? { data: null, updated: 0, requests: 0 }\n            : response;\n        }\n      } else {\n        this._cachedResponses[pubkey] = null;\n      }\n\n      const success = this.checkResponses(true);\n\n      if (\n        Object.keys(this._cachedResponses).length ===\n          Object.keys(this._network.activePeers).length &&\n        !success &&\n        !this._timeout\n      ) {\n        this._cacheChecked = true;\n        this.fetch();\n      }\n    };\n  }\n\n  private getResponseHandler(pubkey: string): (value: DnsResponse) => void {\n    return (value: DnsResponse) => {\n      if (pubkey in this._responses) {\n        return;\n      }\n\n      if (!value) {\n        return;\n      }\n\n      if (\n        this._query.force &&\n        Date.now() - value.updated > this._network.forceTimeout * 1000\n      ) {\n        return;\n      }\n\n      this._responses[pubkey] = this.hasResponseExpired(value)\n        ? null\n        : this.isInvalidResponse(value)\n        ? { data: null, updated: 0, requests: 0 }\n        : value;\n\n      this.pruneDeadPeers();\n      this.checkResponses();\n    };\n  }\n\n  private pruneDeadPeers() {\n    for (const peer in this._responses) {\n      if (!(peer in this._network.activePeers)) {\n        delete this._responses[peer];\n      }\n    }\n  }\n\n  private checkResponses(cached: boolean = false): boolean {\n    const responses: { [response: string]: number } = {};\n    const responseStore = cached ? this._cachedResponses : this._responses;\n\n    if (\n      Object.keys(responseStore).length !==\n      Object.keys(this._network.activePeers).length\n    ) {\n      return false;\n    }\n\n    const responseStoreKeys = Object.keys(responseStore);\n\n    // tslint:disable-next-line:forin\n    for (const peer in responseStore) {\n      const responseIndex = responseStoreKeys.indexOf(peer);\n\n      responses[responseIndex] = responses[responseIndex] ?? 0;\n      responses[responseIndex]++;\n    }\n    for (const responseIndex in responses) {\n      if (responses[responseIndex] >= this._network.majorityThreshold) {\n        const response: DnsResponse | null =\n          responseStore[responseStoreKeys[parseInt(responseIndex, 10)]];\n\n        // @ts-ignore\n        if (null === response || null === response?.data) {\n          if (!cached) {\n            this.retry();\n          }\n          return false;\n        }\n\n        let data;\n\n        try {\n          data = JSON.parse(response?.data as string);\n        } catch (e) {\n          data = response?.data;\n        }\n\n        this.resolve(data);\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  private handeTimeout() {\n    this.resolve(false, true);\n  }\n\n  private resolve(data: any, timeout: boolean = false): void {\n    this.cleanHandlers();\n\n    clearTimeout(this._timeoutTimer);\n    this._timeout = timeout;\n    this._completed = true;\n    // @ts-ignore\n    this._promiseResolve(data);\n  }\n\n  private cleanHandlers() {\n    Object.keys(this._handlers).forEach(\n      // @ts-ignore\n      // tslint:disable-next-line:ban-types\n      (pubkey: string) => {\n        this._handlers[pubkey].off();\n        delete this._handlers[pubkey];\n      }\n    );\n    Object.values(this._cachedTimers).forEach((timer) => clearInterval(timer));\n    this._cachedTimers = {};\n    this._network.off(\"newActivePeer\", this.addPeer as (pubkey: string) => any);\n    this._cachedHandler = {};\n  }\n\n  private fetch() {\n    Object.keys(this._network.activePeers).forEach((peer) =>\n      this.fetchPeer(peer)\n    );\n\n    const query = { ...this._query };\n    query.data = JSON.stringify(query.data);\n\n    this.sendRequest(query);\n  }\n\n  private hasResponseExpired(response: DnsResponse): boolean {\n    return Date.now() - response.updated > this._network.maxTtl * 1000;\n  }\n\n  private retry() {\n    this._cachedResponses = {};\n    this._responses = {};\n    this._cacheChecked = false;\n    this._requestSent = false;\n    this.cleanHandlers();\n\n    if (this._completed) {\n      return;\n    }\n\n    this.init();\n  }\n\n  private sendRequest(query: DnsRequest, id = uuidv4(), count = 0) {\n    if (this._timeout || this._requestSent) {\n      return;\n    }\n\n    if (count > 3) {\n      id = uuidv4();\n      count = 0;\n    } else {\n      count++;\n    }\n\n    const timer = setTimeout(() => {\n      this.sendRequest(query, id, count);\n    }, 100);\n\n    this._network.network\n      .get(\"requests\")\n      .get(id)\n      .put(query, (ack: object) => {\n        clearTimeout(timer);\n        // @ts-ignore\n        if (ack.err) {\n          this.sendRequest(query, id, count);\n        } else {\n          this._requestSent = true;\n        }\n      });\n\n    this._network.network.get(\"requests\").get(id, (data: object) => {\n      clearTimeout(timer);\n      // @ts-ignore\n      if (!data.put) {\n        this.sendRequest(query, id, count);\n      } else {\n        this._requestSent = true;\n      }\n    });\n  }\n\n  private fetchPeer(pubkey: string) {\n    if (pubkey in this._handlers) {\n      return;\n    }\n\n    if (!(pubkey in this._handlers)) {\n      const ref = this._network.network\n        .user(pubkey)\n        .get(\"responses\")\n        .get(this._requestId);\n      this._handlers[pubkey] = subscribe(ref, this.getResponseHandler(pubkey));\n    }\n  }\n\n  private async addPeer(pubkey: string) {\n    await this._network.authed;\n\n    if (this._cacheChecked || this._query.force) {\n      this.fetch();\n      return;\n    }\n\n    if (pubkey in this._cachedHandler) {\n      return;\n    }\n\n    this._cachedHandler[pubkey] = true;\n    this._cachedTimers[pubkey] = setInterval(() => {\n      if (pubkey in this._cachedResponses) {\n        clearInterval(this._cachedTimers[pubkey]);\n        delete this._cachedTimers[pubkey];\n        return;\n      }\n      this._network.network\n        .user(pubkey)\n        .get(\"responses\")\n        .get(this._requestId)\n        .once(this.getCachedRecordHandler(pubkey), { wait: 100 });\n    }, 100);\n  }\n\n  private isInvalidResponse(response: DnsResponse): boolean {\n    if (typeof response.data === \"object\" && !Array.isArray(response.data)) {\n      const data = { ...response.data };\n\n      // @ts-ignore\n      if (data[\"#\"]) {\n        // @ts-ignore\n        delete data[\"#\"];\n      }\n      if (0 === Object.keys(data).length) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n}\n","import Resolver, { Portal } from \"./Resolver.js\";\nimport DnsQuery from \"./DnsQuery.js\";\n// @ts-ignore\nimport Gun from \"@lumeweb/gun\";\nimport { EventEmitter } from \"events\";\nimport { clearTimeout, setTimeout, setInterval } from \"timers\";\n\nexport default class DnsNetwork extends EventEmitter {\n  // @ts-ignore\n  private _network: Gun;\n  private _resolver: Resolver;\n  private _peers: string[] = [];\n  private _user: object = {};\n  private _peerTimeout = 5;\n  private _queryTimeout = 30;\n  private _forceTimeout = 10;\n  private _majorityThreshold = 0.75;\n  private _maxTtl = 12 * 60 * 60;\n  private _activePeers: { [pubkey: string]: number } = {};\n  private _authed: Promise<any>;\n  private _force: boolean = false;\n  private _maxConnectedPeers: number = 10;\n\n  constructor(resolver: Resolver) {\n    super();\n    this._resolver = resolver;\n    this._network = new Gun({\n      localStorage: false,\n      store: Gun.Rmem(),\n      axe: false,\n    });\n    this._authed = this.auth();\n  }\n\n  get maxConnectedPeers(): number {\n    return this._maxConnectedPeers;\n  }\n\n  set maxConnectedPeers(value: number) {\n    this._maxConnectedPeers = value;\n  }\n\n  get force(): boolean {\n    return this._force;\n  }\n\n  set force(value: boolean) {\n    this._force = value;\n  }\n\n  get forceTimeout(): number {\n    return this._forceTimeout;\n  }\n\n  set forceTimeout(value: number) {\n    this._forceTimeout = value;\n  }\n\n  get authed() {\n    return this._authed;\n  }\n\n  get maxTtl(): number {\n    return this._maxTtl;\n  }\n\n  set maxTtl(value: number) {\n    this._maxTtl = value;\n  }\n\n  get queryTimeout(): number {\n    return this._queryTimeout;\n  }\n\n  set queryTimeout(value: number) {\n    this._queryTimeout = value;\n  }\n\n  get majorityThreshold(): number {\n    return this._majorityThreshold;\n  }\n\n  get network() {\n    return this._network;\n  }\n\n  get resolver(): Resolver {\n    return this._resolver;\n  }\n\n  get peers(): string[] {\n    return this._peers;\n  }\n\n  get user(): object {\n    return this._user;\n  }\n\n  get peerTimeout(): number {\n    return this._peerTimeout;\n  }\n\n  set peerTimeout(value: number) {\n    this._peerTimeout = value;\n  }\n\n  get activePeers(): { [pubkey: string]: number } {\n    return this._activePeers;\n  }\n\n  async auth() {\n    const keyPair = await Gun.SEA.pair();\n    await this.promiseRetry((resolve: () => void) => {\n      this._network.user().create(keyPair, resolve);\n    });\n    await this.promiseRetry((resolve: () => void) => {\n      this._network.user().auth(keyPair, resolve);\n    });\n\n    this._user = this._network.user();\n  }\n\n  public addTrustedPeer(peer: string) {\n    this._peers.push(peer);\n    this._peers = [...new Set(this._peers)];\n    this._trackPeerHealth(peer);\n  }\n\n  public query(\n    query: string,\n    chain: string,\n    data: object | any[] = {},\n    force: boolean = false\n  ): DnsQuery {\n    return new DnsQuery(this, {\n      query,\n      chain,\n      data,\n      force: force || this._force,\n    });\n  }\n\n  public async waitForPeers(count = 1): Promise<void> {\n    const hasPeers = () => Object.values(this._activePeers).length >= count;\n\n    if (hasPeers()) {\n      return Promise.resolve();\n    }\n\n    return new Promise((resolve) => {\n      const timer = setInterval(() => {\n        if (hasPeers()) {\n          clearInterval(timer);\n          resolve();\n        }\n      }, 10);\n    });\n  }\n\n  connectToPeers() {\n    const mesh = this._network.back(\"opt.mesh\");\n    const currentPeers = this._network.back(\"opt.peers\");\n    Object.keys(currentPeers).forEach((id) => mesh.bye(id));\n\n    const peers = [];\n\n    let availablePeers = this._peers.slice();\n\n    for (let i = 0; i < this._maxConnectedPeers; i++) {\n      const index = Math.floor(Math.random() * (1 + availablePeers.length - 1));\n      if (availablePeers[index]) {\n        peers.push(`https://${availablePeers[index]}/dns`);\n        delete availablePeers[index];\n        availablePeers = Object.values(availablePeers);\n      }\n\n      if (!availablePeers.length) {\n        break;\n      }\n    }\n\n    peers.forEach((item) => mesh.hi({ url: item }));\n  }\n\n  private _trackPeerHealth(peerDomain: string) {\n    const peer: Portal = this._resolver.getPortal(peerDomain) as Portal;\n    this._network\n      .user(peer.pubkey)\n      .get(\"ping\")\n      .on(this.getPeerPingHandler(peer.pubkey as string));\n  }\n\n  private getPeerPingHandler(pubkey: string): (value: number) => void {\n    return (value: number) => {\n      if (!(pubkey in this._activePeers)) {\n        this.emit(\"newActivePeer\", pubkey);\n      }\n      this._activePeers[pubkey] = value;\n      this.pruneDeadPeers();\n    };\n  }\n\n  private pruneDeadPeers(): void {\n    for (const peer in this._activePeers) {\n      if (Date.now() - this._activePeers[peer] > this._peerTimeout * 1000) {\n        delete this._activePeers[peer];\n      }\n    }\n  }\n\n  // tslint:disable-next-line:ban-types\n  private promiseRetry(callback: Function) {\n    let timer: NodeJS.Timeout;\n\n    return new Promise<void>((resolve) => {\n      timer = setTimeout(() => {\n        resolve(this.promiseRetry(callback));\n      }, 100);\n\n      callback(() => {\n        // tslint:disable-next-line:no-unused-expression\n        timer && clearTimeout(timer);\n        resolve();\n      });\n    });\n  }\n}\n","import SubResolverBase from \"./SubResolverBase.js\";\nimport DnsNetwork from \"./DnsNetwork.js\";\n\nexport interface JSONPortalItem {\n  pubkey?: string;\n  supports: string[];\n}\n\nexport interface JSONPortalList {\n  [domain: string]: JSONPortalItem;\n}\n\nexport interface Portal extends JSONPortalItem {\n  host: string;\n}\n\nexport interface PortalList {\n  [domain: string]: Portal;\n}\n\nexport default class Resolver {\n  private _resolvers: SubResolverBase[] = [];\n  private _portals: PortalList = {};\n  private _dnsNetwork: DnsNetwork;\n\n  constructor() {\n    this._dnsNetwork = new DnsNetwork(this);\n  }\n\n  get resolvers(): SubResolverBase[] {\n    return this._resolvers;\n  }\n\n  get dnsNetwork(): DnsNetwork {\n    return this._dnsNetwork;\n  }\n\n  public async resolve(\n    input: string,\n    params: { [key: string]: any } = {},\n    force: boolean = false\n  ): Promise<string | boolean> {\n    for (const resolver of this._resolvers) {\n      const result = await resolver.resolve(input, params, force);\n      if (result) {\n        return result;\n      }\n    }\n\n    return false;\n  }\n\n  public registerResolver(resolver: SubResolverBase): void {\n    this._resolvers.push(resolver);\n  }\n\n  public registerPortal(\n    host: string,\n    supports: string[],\n    pubkey?: string\n  ): void {\n    this._portals[host] = { pubkey, supports, host };\n\n    if (supports.includes(\"dns\") && pubkey && pubkey.length > 0) {\n      this._dnsNetwork.addTrustedPeer(host);\n    }\n  }\n\n  public registerPortalsFromJson(portals: JSONPortalList) {\n    for (const host of Object.keys(portals)) {\n      const portal: JSONPortalItem = portals[host];\n      this.registerPortal(host, portal.supports, portal.pubkey);\n    }\n  }\n\n  public connect(): void {\n    this._dnsNetwork.connectToPeers();\n  }\n\n  public getPortal(hostname: string): Portal | boolean {\n    if (hostname in this._portals) {\n      return this._portals[hostname];\n    }\n    return false;\n  }\n\n  public getPortals(\n    supports: string[] | string = [],\n    mode: \"and\" | \"or\" = \"and\"\n  ): PortalList {\n    const portals: PortalList = {};\n\n    if (!Array.isArray(supports)) {\n      supports = [supports];\n    }\n\n    if (!supports.length) {\n      return this._portals;\n    }\n\n    // tslint:disable-next-line:forin\n    for (const service of supports) {\n      // tslint:disable-next-line:forin\n      for (const portalDomain in this._portals) {\n        const portal = this._portals[portalDomain];\n        if (this._portals[portalDomain].supports.includes(service)) {\n          portals[portalDomain] = portal;\n        } else {\n          if (mode === \"and\") {\n            delete portals[portalDomain];\n          }\n        }\n      }\n    }\n\n    return portals;\n  }\n\n  public getRandomPortal(\n    supports: string[] | string = [],\n    mode: \"and\" | \"or\" = \"and\"\n  ): Portal | boolean {\n    const portals = this.getPortals(supports, mode);\n\n    const portalDomains = Object.keys(portals);\n\n    if (!portalDomains.length) {\n      return false;\n    }\n\n    const randPortalDomainIndex = Math.floor(\n      Math.random() * (1 + portalDomains.length - 1)\n    );\n\n    return portals[portalDomains[randPortalDomainIndex]];\n  }\n}\n","import Resolver, { Portal } from \"../Resolver.js\";\nimport { SkynetClient } from \"@lumeweb/skynet-js\";\n\n/*\n Copied from https://github.com/SkynetLabs/skynet-kernel/blob/4d44170fa4445004da9d9485148c5553ea668e57/extension/lib/encoding.ts\n */\nconst b64ToBuf = (b64: string): [Uint8Array, Error] => {\n  // Check that the final string is valid base64.\n  const b64regex = /^[0-9a-zA-Z-_/+=]*$/;\n  if (!b64regex.test(b64)) {\n    // @ts-ignore\n    return [null, null];\n  }\n\n  // Swap any '-' characters for '+', and swap any '_' characters for '/'\n  // for use in the atob function.\n  b64 = b64.replace(/-/g, \"+\").replace(/_/g, \"/\");\n\n  // Perform the conversion.\n  const binStr = atob(b64);\n  const len = binStr.length;\n  const buf = new Uint8Array(len);\n  for (let i = 0; i < len; i++) {\n    buf[i] = binStr.charCodeAt(i);\n  }\n  // @ts-ignore\n  return [buf, null];\n};\n\n/*\n Copied from https://github.com/SkynetLabs/skynet-kernel/blob/4d44170fa4445004da9d9485148c5553ea668e57/extension/lib/download.ts\n */\nconst parseSkylinkBitfield = (\n  skylink: Uint8Array\n): [number, number, number, Error] => {\n  // Validate the input.\n  if (skylink.length !== 34) {\n    return [0, 0, 0, new Error(\"provided skylink has incorrect length\")];\n  }\n\n  // Extract the bitfield.\n  let bitfield = new DataView(skylink.buffer).getUint16(0, true);\n\n  // Extract the version.\n  // tslint:disable-next-line:no-bitwise\n  const version = (bitfield & 3) + 1;\n  // Only versions 1 and 2 are recognized.\n  if (version !== 1 && version !== 2) {\n    return [0, 0, 0, new Error(\"provided skylink has unrecognized version\")];\n  }\n\n  // Verify that the mode is valid, then fetch the mode.\n  // tslint:disable-next-line:no-bitwise\n  bitfield = bitfield >> 2;\n  // tslint:disable-next-line:no-bitwise\n  if ((bitfield & 255) === 255) {\n    return [0, 0, 0, new Error(\"provided skylink has an unrecognized version\")];\n  }\n  let mode = 0;\n  for (let i = 0; i < 8; i++) {\n    // tslint:disable-next-line:no-bitwise\n    if ((bitfield & 1) === 0) {\n      // tslint:disable-next-line:no-bitwise\n      bitfield = bitfield >> 1;\n      // tslint:disable-next-line:no-bitwise\n      break;\n    }\n    // tslint:disable-next-line:no-bitwise\n    bitfield = bitfield >> 1;\n    mode++;\n  }\n  // If the mode is greater than 7, this is not a valid v1 skylink.\n  if (mode > 7) {\n    return [0, 0, 0, new Error(\"provided skylink has an invalid v1 bitfield\")];\n  }\n\n  // Determine the offset and fetchSize increment.\n  // tslint:disable-next-line:no-bitwise\n  const offsetIncrement = 4096 << mode;\n  let fetchSizeIncrement = 4096;\n  if (mode > 0) {\n    // tslint:disable-next-line:no-bitwise\n    fetchSizeIncrement = fetchSizeIncrement << (mode - 1);\n  }\n\n  // The next three bits decide the fetchSize.\n  // tslint:disable-next-line:no-bitwise\n  let fetchSizeBits = bitfield & 7;\n  fetchSizeBits++; // semantic upstep, range should be [1,8] not [0,8).\n  const fetchSize = fetchSizeBits * fetchSizeIncrement;\n  // tslint:disable-next-line:no-bitwise\n  bitfield = bitfield >> 3;\n\n  // The remaining bits determine the offset.\n  const offset = bitfield * offsetIncrement;\n  // tslint:disable-next-line:no-bitwise\n  if (offset + fetchSize > 1 << 22) {\n    return [0, 0, 0, new Error(\"provided skylink has an invalid v1 bitfield\")];\n  }\n\n  // Return what we learned.\n  // @ts-ignore\n  return [version, offset, fetchSize, null];\n};\n\nexport function isIp(ip: string) {\n  return /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(\n    ip\n  );\n}\n\nexport function isDomain(domain: string) {\n  return /(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\\.)+[a-z0-9][a-z0-9-]{0,61}[a-z0-9]/.test(\n    domain\n  );\n}\n\nexport const startsWithSkylinkRegExp = /^(sia:\\/\\/)?([a-zA-Z0-9_-]{46})/;\nexport const registryEntryRegExp =\n  /^skyns:\\/\\/(?<publickey>[a-zA-Z0-9%]+)\\/(?<datakey>[a-zA-Z0-9%]+)$/;\n\nexport function normalizeDomain(domain: string): string {\n  return domain.replace(/^\\.+|\\.+$/g, \"\").replace(/^\\/+|\\/+$/g, \"\");\n}\n\nexport async function normalizeSkylink(\n  skylink: string,\n  resolver: Resolver\n): Promise<string | boolean> {\n  // @ts-ignore\n  let matches = skylink.match(startsWithSkylinkRegExp);\n  // @ts-ignore\n  if (matches) {\n    const [u8Link, err64] = b64ToBuf(matches[2]);\n    if (err64 !== null) {\n      return false;\n    }\n    if (u8Link.length !== 34) {\n      return false;\n    }\n\n    const [version, offset, fetchSize, errBF] = parseSkylinkBitfield(u8Link);\n    if (errBF !== null) {\n      return false;\n    }\n\n    return decodeURIComponent(matches[2]);\n  }\n\n  // @ts-ignore\n  matches = skylink.match(registryEntryRegExp);\n\n  // @ts-ignore\n  if (matches) {\n    const portal: Portal = resolver.getRandomPortal(\"registry\") as Portal;\n    if (!portal) {\n      return false;\n    }\n\n    const client = new SkynetClient(`https://${portal.host}`);\n\n    // @ts-ignore\n    const pubKey = decodeURIComponent(matches.groups.publickey).replace(\n      \"ed25519:\",\n      \"\"\n    );\n\n    const entry = await client.registry.getEntry(\n      pubKey,\n      // @ts-ignore\n      matches.groups.datakey,\n      // @ts-ignore\n      { hashedDataKeyHex: true }\n    );\n\n    return Buffer.from(entry.entry?.data as Uint8Array).toString();\n  }\n\n  return false;\n}\n\nexport function getTld(domain: string): string {\n  if (domain.includes(\".\")) {\n    domain = domain.split(\".\")[domain.split(\".\").length - 1];\n  }\n\n  return domain;\n}\n\nexport function getSld(domain: string): string {\n  if (domain.includes(\".\")) {\n    domain = domain\n      .split(\".\")\n      .slice(0, domain.split(\".\").length - 1)\n      .join(\".\");\n  }\n\n  return domain;\n}\n","import ISubResolver from \"./ISubResolver.js\";\nimport Resolver from \"./Resolver.js\";\nimport { getTld } from \"./lib/util.js\";\n\n// @ts-ignore\nexport default abstract class SubResolverBase implements ISubResolver {\n  protected resolver: Resolver;\n\n  constructor(resolver: Resolver) {\n    this.resolver = resolver;\n  }\n\n  abstract resolve(\n    input: string,\n    params: { [key: string]: any },\n    force: boolean\n  ): Promise<string | boolean>;\n\n  getSupportedTlds(): string[] {\n    return [];\n  }\n\n  isTldSupported(domain: string): boolean {\n    return this.getSupportedTlds().includes(getTld(domain));\n  }\n}\n","import {\n  getTld,\n  isDomain,\n  isIp,\n  normalizeDomain,\n  normalizeSkylink,\n} from \"../lib/util.js\";\n\n// @ts-ignore\nimport { SkynetClient } from \"@lumeweb/skynet-js\";\nimport SubResolverBase from \"../SubResolverBase.js\";\n// @ts-ignore\nimport tldEnum from \"@lumeweb/tld-enum\";\nimport DnsQuery from \"../DnsQuery.js\";\nimport Resolver from \"../Resolver.js\";\n\nimport * as ethers from \"ethers\";\n\nexport default class Handshake extends SubResolverBase {\n  private tldBlacklist: string[] = [];\n  constructor(resolver: Resolver) {\n    super(resolver);\n\n    for (const subresolver of resolver.resolvers) {\n      this.tldBlacklist = [\n        ...this.tldBlacklist,\n        ...subresolver.getSupportedTlds(),\n      ];\n    }\n  }\n\n  async resolve(\n    input: string,\n    params: { [key: string]: any } = {},\n    force: boolean = false\n  ): Promise<string | boolean> {\n    const tld = getTld(input);\n\n    if (this.tldBlacklist.includes(tld)) {\n      return false;\n    }\n\n    if (isIp(input)) {\n      return false;\n    }\n\n    if (\"subquery\" in params) {\n      return false;\n    }\n\n    const records = await this.query(tld, force);\n    if (!records) {\n      return false;\n    }\n    let result: string | boolean = false;\n\n    for (const record of (records as { [key: string]: any }[]).reverse()) {\n      switch (record.type) {\n        case \"NS\": {\n          result = await this.processNs(input, record, records, force);\n          break;\n        }\n        case \"GLUE4\": {\n          result = await this.processGlue(input, record, force);\n          break;\n        }\n        case \"TXT\": {\n          result = await this.processTxt(record);\n          break;\n        }\n        case \"SYNTH6\": {\n          if (\"ipv6\" in params && params.ipv6) {\n            result = record.address;\n          }\n          break;\n        }\n        case \"SYNTH4\": {\n          result = record.address;\n          break;\n        }\n        default: {\n          break;\n        }\n      }\n\n      if (result) {\n        break;\n      }\n    }\n\n    return result;\n  }\n\n  // @ts-ignore\n  private async processNs(domain: string, record, records, force: boolean) {\n    // @ts-ignore\n    const glue = records.slice().find(\n      (item: object) =>\n        // @ts-ignore\n        [\"GLUE4\", \"GLUE6\"].includes(item.type) && item.ns === record.ns\n    );\n\n    if (glue) {\n      return this.processGlue(domain, record, force);\n    }\n\n    const foundDomain = normalizeDomain(record.ns);\n    let isIcann = false;\n\n    let isEvmAddress = false;\n\n    if (\n      foundDomain.split(\".\").length >= 2 &&\n      ethers.utils.isAddress(foundDomain.split(\".\")[0])\n    ) {\n      isEvmAddress = true;\n    }\n\n    if (\n      (isDomain(foundDomain) || /[a-zA-Z0-9\\-]+/.test(foundDomain)) &&\n      !isEvmAddress\n    ) {\n      if (foundDomain.includes(\".\")) {\n        const tld = foundDomain.split(\".\")[foundDomain.split(\".\").length - 1];\n\n        isIcann = tldEnum.list.includes(tld);\n      }\n\n      if (!isIcann) {\n        const hnsNs = await this.resolver.resolve(foundDomain, { force });\n\n        if (hnsNs) {\n          return this.resolver.resolve(domain, {\n            subquery: true,\n            nameserver: hnsNs,\n            force,\n          });\n        }\n      }\n\n      return this.resolver.resolve(\n        domain,\n        {\n          subquery: true,\n          nameserver: foundDomain,\n        },\n        force\n      );\n    }\n\n    const result = await this.resolver.resolve(record.ns, { domain }, force);\n\n    return result || record.ns;\n  }\n\n  private async processGlue(domain: string, record: any, force: boolean) {\n    if (isDomain(record.ns) && isIp(record.address)) {\n      return this.resolver.resolve(\n        domain,\n        {\n          subquery: true,\n          nameserver: record.address,\n        },\n        force\n      );\n    }\n\n    return false;\n  }\n\n  private async query(tld: string, force: boolean): Promise<object | boolean> {\n    const query: DnsQuery = this.resolver.dnsNetwork.query(\n      \"getnameresource\",\n      \"hns\",\n      [tld],\n      force\n    );\n    const resp = await query.promise;\n\n    // @ts-ignore\n    return resp?.records || [];\n  }\n\n  private async processTxt(record: any): Promise<string | boolean> {\n    const content = record.txt.slice().pop();\n\n    const skylink = await normalizeSkylink(content, this.resolver);\n\n    if (skylink) {\n      return skylink;\n    }\n\n    return content;\n  }\n}\n","import { isDomain } from \"../lib/util.js\";\n\n// @ts-ignore\nimport SubResolverBase from \"../SubResolverBase.js\";\n\nexport default class Icann extends SubResolverBase {\n  async resolve(\n    input: string,\n    params: { [key: string]: any } = {},\n    force = false\n  ): Promise<string | boolean> {\n    if (!params || !(\"subquery\" in params) || !params.subquery) {\n      return false;\n    }\n\n    if (!isDomain(input) && !(\"nameserver\" in params || !params.nameserver)) {\n      return false;\n    }\n\n    const data = {\n      domain: input,\n      nameserver: params.nameserver ?? undefined,\n    };\n\n    const query = this.resolver.dnsNetwork.query(\n      \"dnslookup\",\n      \"icann\",\n      data,\n      force\n    );\n\n    return query.promise;\n  }\n}\n","// @ts-ignore\nimport ENSRoot, { getEnsAddress } from \"@lumeweb/ensjs\";\nimport { ethers } from \"ethers\";\nimport SubResolverBase from \"../SubResolverBase.js\";\nimport GunProvider from \"./eip137/GunProvider.js\";\nimport pocketNetworks from \"../data/pocketNetworks.js\";\nimport { isDomain, normalizeDomain, normalizeSkylink } from \"../lib/util.js\";\n// @ts-ignore\nimport tldEnum from \"@lumeweb/tld-enum\";\n\nconst ENS = ENSRoot.default;\n\nconst networkMap: { [key: string]: string } = {\n  eth: \"eth-mainnet\",\n};\n\nfunction isResponseEmpty(data: any) {\n  if (!data) {\n    return true;\n  }\n\n  if (ethers.utils.isHexString(data)) {\n    const normalizedData = ethers.utils.stripZeros(data).toString();\n    if (!normalizedData) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nexport default class Eip137 extends SubResolverBase {\n  getSupportedTlds(): string[] {\n    return [\"eth\"];\n  }\n\n  async resolve(\n    input: string,\n    params: { [key: string]: any } = {},\n    force: boolean = false\n  ): Promise<string | boolean> {\n    if (this.isTldSupported(input)) {\n      return this.resolveEns(input, force);\n    }\n\n    const hip5Data = input.split(\".\");\n    // @ts-ignore\n    if (2 <= hip5Data.length && \"domain\" in params) {\n      if (ethers.utils.isAddress(hip5Data[0])) {\n        // @ts-ignore\n        return this.resolveHip5(params.domain, hip5Data, force);\n      }\n    }\n\n    return false;\n  }\n\n  private async resolveEns(\n    input: string,\n    force: boolean = false\n  ): Promise<string | boolean> {\n    const data = [getEnsAddress(\"1\"), networkMap.eth];\n\n    return this.resolveHip5(input, data, force);\n  }\n\n  private async resolveHip5(\n    domain: string,\n    data: string[],\n    force: boolean = false\n  ): Promise<string | boolean> {\n    let chain = data[1].replace(\"_\", \"\");\n\n    if (chain in networkMap) {\n      chain = networkMap[chain];\n    }\n    if (chain in pocketNetworks) {\n      chain = pocketNetworks[chain];\n    }\n\n    const connection: GunProvider = new GunProvider(\n      chain,\n      this.resolver.dnsNetwork,\n      force\n    );\n\n    // @ts-ignore\n    const ens = new ENS({ provider: connection, ensAddress: data[0] });\n\n    try {\n      const name = await ens.name(domain);\n      const contentResult = await name.getContent();\n      let content;\n      let result: string | boolean = false;\n\n      if (typeof contentResult === \"string\" && 0 === Number(contentResult)) {\n        content = false;\n      }\n\n      if (\n        typeof contentResult === \"object\" &&\n        \"contenthash\" === contentResult.contentType\n      ) {\n        content = contentResult.value;\n      }\n\n      if (content) {\n        result = content;\n      }\n\n      const skylink = await normalizeSkylink(result as string, this.resolver);\n\n      if (skylink) {\n        return skylink;\n      }\n\n      /*\n                    Future DNS support\n                   */\n      /*if (isResponseEmpty(result)) {\n                    result = await name.getText(\"A\");\n                  }\n\n                  if (isResponseEmpty(result)) {\n                    result = await name.getText(\"CNAME\");\n                  }\n\n                  if (isResponseEmpty(result)) {\n                    result = await name.getText(\"NS\");\n                    if (result) {\n                      result = normalizeDomain(result as string);\n                      let isIcann = false;\n                      if (isDomain(result) || /[a-zA-Z0-9\\-]+/.test(result)) {\n                        if (result.includes(\".\")) {\n                          const tld = result.split(\".\")[result.split(\".\").length - 1];\n                          isIcann = tldEnum.list.includes(tld);\n                        }\n\n                        if (!isIcann) {\n                          const evmNs = await this.resolver.resolve(result, { force });\n\n                          if (result) {\n                            return this.resolver.resolve(domain, {\n                              subquery: true,\n                              nameserver: evmNs,\n                              force,\n                            });\n                          }\n                        }\n\n                        result = await this.resolver.resolve(\n                          domain,\n                          {\n                            subquery: true,\n                            nameserver: result,\n                          },\n                          force\n                        );\n                      }\n                    }\n                  }*/\n\n      return result;\n    } catch (e) {\n      return false;\n    }\n  }\n}\n","import * as ethers from \"ethers\";\nimport * as ethersNetwork from \"@ethersproject/networks\";\nimport * as ethersTransactions from \"@ethersproject/transactions\";\nimport * as ethersProperties from \"@ethersproject/properties\";\nimport * as ethersBytes from \"@ethersproject/bytes\";\nimport * as ethersLogger from \"@ethersproject/logger\";\nimport * as ethersAbstractProvider from \"@ethersproject/abstract-provider\";\nimport * as ethersAbstractSigner from \"@ethersproject/abstract-signer\";\nimport * as ethersStrings from \"@ethersproject/strings\";\nimport DnsNetwork from \"../../DnsNetwork.js\";\nimport { poll } from \"@ethersproject/web\";\nimport { _TypedDataEncoder } from \"@ethersproject/hash\";\n\nconst { defineReadOnly, resolveProperties, shallowCopy } = ethersProperties;\nconst { Logger } = ethersLogger;\nconst { toUtf8Bytes } = ethersStrings;\nconst { hexlify } = ethersBytes;\n\nfunction getLowerCase(value: string): string {\n  if (value) {\n    return value.toLowerCase();\n  }\n  return value;\n}\n\nconst allowedTransactionKeys: { [key: string]: boolean } = {\n  chainId: true,\n  data: true,\n  gasLimit: true,\n  gasPrice: true,\n  nonce: true,\n  to: true,\n  value: true,\n  type: true,\n  accessList: true,\n  maxFeePerGas: true,\n  maxPriorityFeePerGas: true,\n};\n\nconst errorGas = [\"call\", \"estimateGas\"];\n\nfunction checkError(method: string, error: any, params: any): any {\n  // Undo the \"convenience\" some nodes are attempting to prevent backwards\n  // incompatibility; maybe for v6 consider forwarding reverts as errors\n  if (\n    method === \"call\" &&\n    error.code === ethersLogger.Logger.errors.SERVER_ERROR\n  ) {\n    const e = error.error;\n    if (e && e.message.match(\"reverted\") && ethersBytes.isHexString(e.data)) {\n      return e.data;\n    }\n\n    ethers.ethers.logger.throwError(\n      \"missing revert data in call exception\",\n      ethersLogger.Logger.errors.CALL_EXCEPTION,\n      {\n        error,\n        data: \"0x\",\n      }\n    );\n  }\n\n  let message = error.message;\n  if (\n    error.code === ethersLogger.Logger.errors.SERVER_ERROR &&\n    error.error &&\n    typeof error.error.message === \"string\"\n  ) {\n    message = error.error.message;\n  } else if (typeof error.body === \"string\") {\n    message = error.body;\n  } else if (typeof error.responseText === \"string\") {\n    message = error.responseText;\n  }\n  message = (message || \"\").toLowerCase();\n\n  const transaction = params.transaction || params.signedTransaction;\n\n  // \"insufficient funds for gas * price + value + cost(data)\"\n  if (message.match(/insufficient funds|base fee exceeds gas limit/)) {\n    ethers.ethers.logger.throwError(\n      \"insufficient funds for intrinsic transaction cost\",\n      ethersLogger.Logger.errors.INSUFFICIENT_FUNDS,\n      {\n        error,\n        method,\n        transaction,\n      }\n    );\n  }\n\n  // \"nonce too low\"\n  if (message.match(/nonce too low/)) {\n    ethers.logger.throwError(\n      \"nonce has already been used\",\n      ethersLogger.Logger.errors.NONCE_EXPIRED,\n      {\n        error,\n        method,\n        transaction,\n      }\n    );\n  }\n\n  // \"replacement transaction underpriced\"\n  if (message.match(/replacement transaction underpriced/)) {\n    ethers.logger.throwError(\n      \"replacement fee too low\",\n      ethersLogger.Logger.errors.REPLACEMENT_UNDERPRICED,\n      {\n        error,\n        method,\n        transaction,\n      }\n    );\n  }\n\n  // \"replacement transaction underpriced\"\n  if (message.match(/only replay-protected/)) {\n    ethers.logger.throwError(\n      \"legacy pre-eip-155 transactions not supported\",\n      ethersLogger.Logger.errors.UNSUPPORTED_OPERATION,\n      {\n        error,\n        method,\n        transaction,\n      }\n    );\n  }\n\n  if (\n    errorGas.indexOf(method) >= 0 &&\n    message.match(\n      /gas required exceeds allowance|always failing transaction|execution reverted/\n    )\n  ) {\n    ethers.logger.throwError(\n      \"cannot estimate gas; transaction may fail or may require manual gas limit\",\n      ethersLogger.Logger.errors.UNPREDICTABLE_GAS_LIMIT,\n      {\n        error,\n        method,\n        transaction,\n      }\n    );\n  }\n\n  throw error;\n}\n\nexport default class GunProvider extends ethers.providers.BaseProvider {\n  private _dnsChain: string;\n  private _dnsNetwork: DnsNetwork;\n  private _force: boolean;\n\n  constructor(\n    dnsChain: string,\n    dnsNetwork: DnsNetwork,\n    force: boolean = false\n  ) {\n    const networkOrReady:\n      | ethersNetwork.Networkish\n      | Promise<ethersNetwork.Network> = { name: \"dummy\", chainId: 0 };\n    super(networkOrReady);\n    this._dnsChain = dnsChain;\n    this._dnsNetwork = dnsNetwork;\n    this._force = force;\n  }\n\n  async detectNetwork(): Promise<ethersNetwork.Network> {\n    return { name: \"dummy\", chainId: 0 };\n  }\n\n  async send(method: string, params: any[]): Promise<any> {\n    const query = this._dnsNetwork.query(\n      method,\n      this._dnsChain,\n      params,\n      this._force\n    );\n    let resp = await query.promise;\n\n    try {\n      hexlify(resp);\n    } catch (e) {\n      resp = \"0x\" + \"0\".repeat(65);\n    }\n\n    return resp;\n  }\n\n  prepareRequest(method: string, params: any): [string, any[]] | null {\n    switch (method) {\n      case \"call\": {\n        const hexlifyTransaction = ethers.utils.getStatic<\n          (\n            t: ethers.providers.TransactionRequest,\n            a?: { [key: string]: boolean }\n          ) => { [key: string]: string }\n        >(this.constructor, \"hexlifyTransaction\");\n        return [\n          \"eth_call\",\n          [\n            hexlifyTransaction(params.transaction, { from: true }),\n            params.blockTag,\n          ],\n        ];\n      }\n\n      default:\n        break;\n    }\n\n    return null;\n  }\n\n  async perform(method: string, params: any): Promise<any> {\n    // Legacy networks do not like the type field being passed along (which\n    // is fair), so we delete type if it is 0 and a non-EIP-1559 network\n    if (method === \"call\") {\n      const tx = params.transaction;\n      if (tx && tx.type != null && ethers.BigNumber.from(tx.type).isZero()) {\n        // If there are no EIP-1559 properties, it might be non-EIP-a559\n        if (tx.maxFeePerGas == null && tx.maxPriorityFeePerGas == null) {\n          // Network doesn't know about EIP-1559 (and hence type)\n          params = ethersProperties.shallowCopy(params);\n          params.transaction = ethersProperties.shallowCopy(tx);\n          delete params.transaction.type;\n        }\n      }\n    }\n\n    const args = this.prepareRequest(method, params);\n\n    try {\n      // @ts-ignore\n      return await this.send(args[0], args[1]);\n    } catch (error) {\n      return checkError(method, error, params);\n    }\n  }\n\n  // Convert an ethers.js transaction into a JSON-RPC transaction\n  //  - gasLimit => gas\n  //  - All values hexlified\n  //  - All numeric values zero-striped\n  //  - All addresses are lowercased\n  // NOTE: This allows a TransactionRequest, but all values should be resolved\n  //       before this is called\n  // @TODO: This will likely be removed in future versions and prepareRequest\n  //        will be the preferred method for this.\n  static hexlifyTransaction(\n    transaction: ethers.providers.TransactionRequest,\n    allowExtra?: { [key: string]: boolean }\n  ): { [key: string]: string | ethersTransactions.AccessList } {\n    // Check only allowed properties are given\n    const allowed = ethersProperties.shallowCopy(allowedTransactionKeys);\n    if (allowExtra) {\n      for (const key in allowExtra) {\n        if (allowExtra[key]) {\n          allowed[key] = true;\n        }\n      }\n    }\n\n    const result: { [key: string]: string | ethersTransactions.AccessList } =\n      {};\n\n    // Some nodes (INFURA ropsten; INFURA mainnet is fine) do not like leading zeros.\n    [\n      \"gasLimit\",\n      \"gasPrice\",\n      \"type\",\n      \"maxFeePerGas\",\n      \"maxPriorityFeePerGas\",\n      \"nonce\",\n      \"value\",\n    ].forEach((key) => {\n      if ((transaction as any)[key] == null) {\n        return;\n      }\n      const value = ethersBytes.hexValue((transaction as any)[key]);\n      if (key === \"gasLimit\") {\n        key = \"gas\";\n      }\n      result[key] = value;\n    });\n\n    [\"from\", \"to\", \"data\"].forEach((key) => {\n      if ((transaction as any)[key] == null) {\n        return;\n      }\n      result[key] = ethersBytes.hexlify((transaction as any)[key]);\n    });\n\n    if ((transaction as any).accessList) {\n      result.accessList = ethersTransactions.accessListify(\n        (transaction as any).accessList\n      );\n    }\n\n    return result;\n  }\n\n  // @ts-ignore\n  getSigner(addressOrIndex?: string | number): GunSigner {\n    // @ts-ignore\n    return new GunSigner({}, this, addressOrIndex);\n  }\n}\n\n// tslint:disable-next-line:max-classes-per-file\nclass GunSigner extends ethersAbstractSigner.Signer {\n  // @ts-ignore\n  readonly provider: GunProvider;\n  // @ts-ignore\n  private _index: number;\n  // @ts-ignore\n  private _address: string;\n  // @ts-ignore\n  constructor(provider: GunProvider, addressOrIndex?: string | number) {\n    super();\n    // @ts-ignore\n    defineReadOnly(this, \"provider\", provider);\n\n    if (addressOrIndex == null) {\n      addressOrIndex = 0;\n    }\n\n    if (typeof addressOrIndex === \"string\") {\n      defineReadOnly(\n        this,\n        // @ts-ignore\n        \"_address\",\n        // @ts-ignore\n        this.provider.formatter.address(addressOrIndex)\n      );\n      // @ts-ignore\n      defineReadOnly(this, \"_index\", null);\n    } else if (typeof addressOrIndex === \"number\") {\n      // @ts-ignore\n      defineReadOnly(this, \"_index\", addressOrIndex);\n      // @ts-ignore\n      defineReadOnly(this, \"_address\", null);\n    }\n  }\n\n  connect(provider: GunProvider): GunSigner {\n    return ethers.logger.throwError(\n      \"cannot alter JSON-RPC Signer connection\",\n      Logger.errors.UNSUPPORTED_OPERATION,\n      {\n        operation: \"connect\",\n      }\n    );\n  }\n  getAddress(): Promise<string> {\n    // @ts-ignore\n    if (this._address) {\n      return Promise.resolve(this._address);\n    }\n\n    return this.provider.send(\"eth_accounts\", []).then((accounts) => {\n      if (accounts.length <= this._index) {\n        ethers.logger.throwError(\n          \"unknown account #\" + this._index,\n          Logger.errors.UNSUPPORTED_OPERATION,\n          {\n            operation: \"getAddress\",\n          }\n        );\n      }\n      return this.provider.formatter.address(accounts[this._index]);\n    });\n  }\n\n  sendUncheckedTransaction(\n    transaction: ethersProperties.Deferrable<ethersAbstractProvider.TransactionRequest>\n  ): Promise<string> {\n    transaction = shallowCopy(transaction);\n\n    const fromAddress = this.getAddress().then((address) => {\n      if (address) {\n        address = address.toLowerCase();\n      }\n      return address;\n    });\n\n    // The JSON-RPC for eth_sendTransaction uses 90000 gas; if the user\n    // wishes to use this, it is easy to specify explicitly, otherwise\n    // we look it up for them.\n    if (transaction.gasLimit == null) {\n      const estimate = shallowCopy(transaction);\n      estimate.from = fromAddress;\n      transaction.gasLimit = this.provider.estimateGas(estimate);\n    }\n\n    if (transaction.to != null) {\n      // @ts-ignore\n      transaction.to = Promise.resolve(transaction.to).then(async (to) => {\n        if (to == null) {\n          return null;\n        }\n        const address = await this.provider.resolveName(to);\n        if (address == null) {\n          ethers.logger.throwArgumentError(\n            \"provided ENS name resolves to null\",\n            \"tx.to\",\n            to\n          );\n        }\n        return address;\n      });\n    }\n\n    return resolveProperties({\n      tx: resolveProperties(transaction),\n      sender: fromAddress,\n    }).then(({ tx, sender }) => {\n      if (tx.from != null) {\n        if (tx.from.toLowerCase() !== sender) {\n          ethers.logger.throwArgumentError(\n            \"from address mismatch\",\n            \"transaction\",\n            transaction\n          );\n        }\n      } else {\n        tx.from = sender;\n      }\n\n      const hexTx = (this.provider.constructor as any).hexlifyTransaction(tx, {\n        from: true,\n      });\n\n      return this.provider.send(\"eth_sendTransaction\", [hexTx]).then(\n        (hash) => {\n          return hash;\n        },\n        (error) => {\n          return checkError(\"sendTransaction\", error, hexTx);\n        }\n      );\n    });\n  }\n\n  signTransaction(\n    transaction: ethersProperties.Deferrable<ethersAbstractProvider.TransactionRequest>\n  ): Promise<string> {\n    return ethers.logger.throwError(\n      \"signing transactions is unsupported\",\n      Logger.errors.UNSUPPORTED_OPERATION,\n      {\n        operation: \"signTransaction\",\n      }\n    );\n  }\n\n  async sendTransaction(\n    transaction: ethersProperties.Deferrable<ethersAbstractProvider.TransactionRequest>\n  ): Promise<ethersAbstractProvider.TransactionResponse> {\n    // This cannot be mined any earlier than any recent block\n    const blockNumber = await this.provider._getInternalBlockNumber(\n      100 + 2 * this.provider.pollingInterval\n    );\n\n    // Send the transaction\n    const hash = await this.sendUncheckedTransaction(transaction);\n\n    try {\n      // Unfortunately, JSON-RPC only provides and opaque transaction hash\n      // for a response, and we need the actual transaction, so we poll\n      // for it; it should show up very quickly\n      // @ts-ignore\n      return await poll(\n        async () => {\n          const tx = await this.provider.getTransaction(hash);\n          if (tx === null) {\n            return undefined;\n          }\n          return this.provider._wrapTransaction(tx, hash, blockNumber);\n        },\n        { oncePoll: this.provider }\n      );\n    } catch (error) {\n      (error as any).transactionHash = hash;\n      throw error;\n    }\n  }\n\n  async signMessage(message: ethers.Bytes | string): Promise<string> {\n    const data = typeof message === \"string\" ? toUtf8Bytes(message) : message;\n    const address = await this.getAddress();\n\n    return this.provider.send(\"personal_sign\", [\n      hexlify(data),\n      address.toLowerCase(),\n    ]);\n  }\n\n  async _legacySignMessage(message: ethers.Bytes | string): Promise<string> {\n    const data = typeof message === \"string\" ? toUtf8Bytes(message) : message;\n    const address = await this.getAddress();\n\n    // https://github.com/ethereum/wiki/wiki/JSON-RPC#eth_sign\n    return this.provider.send(\"eth_sign\", [\n      address.toLowerCase(),\n      hexlify(data),\n    ]);\n  }\n\n  async _signTypedData(\n    domain: ethersAbstractSigner.TypedDataDomain,\n    types: Record<string, ethersAbstractSigner.TypedDataField[]>,\n    value: Record<string, any>\n  ): Promise<string> {\n    // Populate any ENS names (in-place)\n    const populated = await _TypedDataEncoder.resolveNames(\n      domain,\n      types,\n      value,\n      // @ts-ignore\n      (name: string) => {\n        return this.provider.resolveName(name);\n      }\n    );\n\n    const address = await this.getAddress();\n\n    return this.provider.send(\"eth_signTypedData_v4\", [\n      address.toLowerCase(),\n      JSON.stringify(\n        _TypedDataEncoder.getPayload(populated.domain, types, populated.value)\n      ),\n    ]);\n  }\n\n  async unlock(password: string): Promise<boolean> {\n    const provider = this.provider;\n\n    const address = await this.getAddress();\n\n    return provider.send(\"personal_unlockAccount\", [\n      address.toLowerCase(),\n      password,\n      null,\n    ]);\n  }\n}\n","const pocketNetworks: { [name: string]: string } = {\n  \"algorand-mainnet\": \"29\",\n  \"algorand-archival\": \"000D\",\n  \"algorand-testnet\": \"45\",\n  \"algorand-testnet-archival\": \"0A45\",\n  \"arweave-mainnet\": \"30\",\n  \"avax-mainnet\": \"3\",\n  \"avax-archival\": \"00A3\",\n  \"avax-fuji\": \"000E\",\n  \"bsc-mainnet\": \"4\",\n  \"bsc-archival\": \"10\",\n  \"bsc-testnet\": \"11\",\n  \"bsc-testnet-archival\": \"12\",\n  \"btc-mainnet\": \"2\",\n  \"eth-mainnet\": \"21\",\n  \"eth-archival\": \"22\",\n  \"eth-archival-trace\": \"28\",\n  \"eth-goerli\": \"26\",\n  \"poa-kovan\": \"24\",\n  \"eth-rinkeby\": \"25\",\n  \"eth-ropsten\": \"23\",\n  \"evmos-mainnet\": \"46\",\n  \"fuse-mainnet\": \"5\",\n  \"fuse-archival\": \"000A\",\n  \"gnosischain-mainnet\": \"27\",\n  \"gnosischain-archival\": \"000C\",\n  \"harmony-0\": \"40\",\n  \"harmony-0-archival\": \"0A40\",\n  \"harmony-1\": \"41\",\n  \"harmony-1-archival\": \"0A41\",\n  \"harmony-2\": \"42\",\n  \"harmony-2-archival\": \"0A42\",\n  \"harmony-3\": \"43\",\n  \"harmony-3-archival\": \"0A43\",\n  \"iotex-mainnet\": \"44\",\n  \"oec-mainnet\": \"47\",\n  mainnet: \"1\",\n  \"poly-mainnet\": \"9\",\n  \"poly-archival\": \"000B\",\n  \"poly-mumbai\": \"000F\",\n  \"poly-mumbai-archival\": \"00AF\",\n  \"sol-mainnet\": \"6\",\n  \"sol-testnet\": \"31\",\n};\nexport default pocketNetworks;\n","import SubResolverBase from \"../SubResolverBase.js\";\nimport {\n  getHashedName,\n  getNameAccountKey,\n  NameRegistryState,\n} from \"@bonfida/spl-name-service\";\nimport { PublicKey } from \"@solana/web3.js\";\nimport Connection from \"./solana/connection.js\";\nimport { deserializeUnchecked } from \"borsh\";\nimport { getSld, normalizeSkylink } from \"../lib/util.js\";\n\nconst SOL_TLD_AUTHORITY = new PublicKey(\n  \"58PwtjSDuFHuUkYjH9BYnnQKHfwo9reZhC2zMJv9JPkx\"\n);\n\nexport default class Solana extends SubResolverBase {\n  async resolve(\n    input: string,\n    params: { [p: string]: any },\n    force: boolean\n  ): Promise<string | boolean> {\n    if (!this.isTldSupported(input)) {\n      return false;\n    }\n\n    const hashedName = await getHashedName(getSld(input));\n\n    const domainKey = await getNameAccountKey(\n      hashedName,\n      undefined,\n      SOL_TLD_AUTHORITY\n    );\n\n    const connection = new Connection(this.resolver.dnsNetwork, force);\n\n    const nameAccount = await connection.getAccountInfo(domainKey, \"processed\");\n    if (!nameAccount) {\n      return false;\n    }\n\n    const res: NameRegistryState = deserializeUnchecked(\n      NameRegistryState.schema,\n      NameRegistryState,\n      nameAccount.data\n    );\n\n    res.data = nameAccount.data?.slice(NameRegistryState.HEADER_LEN);\n\n    let content = res.data.toString(\"ascii\").replace(/\\0/g, \"\");\n\n    let skylink = await normalizeSkylink(content, this.resolver);\n\n    if (skylink) {\n      return skylink;\n    }\n\n    if (content.includes(\"=\")) {\n      content = content.split(\"=\")[0];\n    }\n\n    skylink = await normalizeSkylink(content, this.resolver);\n\n    if (skylink) {\n      return skylink;\n    }\n\n    return content;\n  }\n\n  getSupportedTlds(): string[] {\n    return [\"sol\"];\n  }\n}\n","import { Connection as SolanaConnection } from \"@solana/web3.js\";\nimport DnsNetwork from \"../../DnsNetwork.js\";\nimport pocketNetworks from \"../../data/pocketNetworks.js\";\n\nexport default class Connection extends SolanaConnection {\n  private _network: DnsNetwork;\n  // @ts-ignore\n  private _force: boolean;\n\n  constructor(network: DnsNetwork, force = false) {\n    super(\"http://0.0.0.0\");\n    this._force = force;\n    // @ts-ignore\n    this._network = network;\n    // @ts-ignore\n    this._rpcWebSocket.removeAllListeners();\n    // @ts-ignore\n    this._rpcRequest = this.__rpcRequest;\n  }\n\n  async __rpcRequest(methodName: string, args: any[]) {\n    const req = this._network.query(\n      methodName,\n      pocketNetworks[\"sol-mainnet\"],\n      args,\n      this._force\n    );\n\n    return req.promise;\n  }\n}\n"],"mappings":"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","names":[]}